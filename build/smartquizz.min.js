window.IB = window.IB || {}; window.IB.sd = window.IB.sd || {}; window.IB=window.IB||{},window.IB.sd=window.IB.sd||{},function(){function handleInteraction(elem,data,ds,revisited){if(console.log("handle interaction"),console.log(data,ds),ds.growl)for(var growls=ds.growl.split(";"),ir=0,lr=growls.length;lr>ir;ir++){var rule=growls[ir],ruleParts=rule.split(":"),text=ruleParts[0].trim(),condition=ruleParts[1].trim();condition=condition.replace("\\gt",">").replace("\\ge",">=").replace("\\lt","<").replace("\\le","<=");var fullfilled=eval(""+data.score+condition);if(fullfilled){if(revisited||console.log("Must say aloud if not revisited ",text),hasOverlay){elem.querySelector("iframe").style["pointer-events"]="none";var overlay=new Overlay(elem);overlay.modal(!0),overlay.msg(text)}break}}if(hasSections)for(var sectionInstances=Object.values(IB.sd.tiles.inst||{}),ks=0,lks=sectionInstances.length;lks>ks;ks++)sectionInstances[ks].autoCollapse&&sectionInstances[ks].autoCollapse();if(ds.scroll)for(var scrolls=ds.scroll.split(";"),ir=0,lr=scrolls.length;lr>ir;ir++){var scroll=scrolls[ir],ruleParts=scroll.split(":"),sec=ruleParts[0].trim(),condition=ruleParts[1].trim();condition=condition.replace("\\gt",">").replace("\\ge",">=").replace("\\lt","<").replace("\\le","<=");var fullfilled=eval(""+data.score+condition);if(fullfilled=condition.replace("\\gt",">").replace("\\ge",">=").replace("\\lt","<").replace("\\le","<=")){if(!revisited){console.log("Must scroll to ",sec);var aTag=$("a[name='"+sec+"']");$("html,body").animate({scrollTop:aTag.offset().top-200},"fast")}console.log("I would not go to ",sec);break}}}function initApi(elem){var flatten=function(e){if(!e)return"";if("object"!=typeof e)return e;for(var t=Object.keys(e),o="",r=0,a=t.length;a>r;r++)o+=e[t[r]]+" ";return o},h5p_filter=document.querySelector('[role="smartquizz"]'),h5p_filter_iframe=h5p_filter.querySelector("iframe");if(h5p_filter_iframe){var embed_doc=h5p_filter_iframe.contentWindow;console.log(embed_doc);var h5p_iframe=embed_doc.document.querySelector("iframe.h5p-iframe");if(console.log(h5p_iframe),!h5p_iframe)return!1;h5p_iframe=h5p_iframe.contentWindow,console.log(h5p_iframe);var H5P=h5p_iframe.H5P;if(console.log(H5P),!H5P)return console.log("NO H5P trying latter"),!1;var preguntes={};return H5P.externalDispatcher.on("xAPI",function(evt){console.log(evt);var data=evt.data,st=data.statement,verb=st.verb.id,r=st.result,isCompleted="http://adlnet.gov/expapi/verbs/completed"==verb,isInteracted="http://adlnet.gov/expapi/verbs/interacted"==verb,pregunta=flatten(st.object.definition.name).trim(),ascore=10*evt.getScore()/evt.getMaxScore();if(hasIAPace&&elem.dataset.category&&null!=ascore&&!isNaN(ascore)&&(preguntes[pregunta]=ascore,console.log("Adding score to "+elem.dataset.category,ascore),IB.iapace.addScore(elem.dataset.category,ascore)),isCompleted){var overallScore=10*r.score.scaled,persistData={completion:r.completion,success:r.success,score:overallScore,preguntes:preguntes};if(hasIAPace&&IB.iapace.saveInitialEval(elem.id,persistData),elem.dataset.confetti&&hasConfetti){var condition=elem.dataset.confetti;condition=condition.replace("\\gt",">").replace("\\ge",">=").replace("\\lt","<").replace("\\le","<=");var fullfilled=eval(""+overallScore+condition);if(fullfilled){var confetti=new Confetti(elem);confetti.play(),window.setTimeout(function(){handleInteraction(elem,persistData,h5p_filter.dataset,!1)},1500)}else handleInteraction(elem,persistData,h5p_filter.dataset,!1)}else handleInteraction(elem,persistData,h5p_filter.dataset,!1)}}),!0}}var hasSections=null!=window.IB.sd.tiles,hasIAPace=null!=window.IB&&null!=window.IB.iapace,hasOverlay=null!=window.Overlay,hasConfetti=null!=window.Confetti;hasSections||console.error("Sections module required"),hasIAPace||console.error("IAPace module required"),hasOverlay||console.error("Overlay module required"),hasConfetti||console.error("Confetti module required");var COMPONENT_NAME="smartquizz";if(window.IB.sd[COMPONENT_NAME])return console.error("Warning: "+COMPONENT_NAME+" loaded twice."),void(window.IB.sd[COMPONENT_NAME].bind&&window.IB.sd[COMPONENT_NAME].bind());var FunctionAttemptExec=function(e,t,o,r){var a=e(r);!a&&t>0&&window.setTimeout(function(){FunctionAttemptExec(e,t-1,o,r)},o)},alias={author:"Josep Mulet",version:"1.0",inst:{}};window.IB.sd[COMPONENT_NAME]=alias;var bind=function(){for(var e=document.querySelectorAll('[role="smartquizz"]'),t=0,o=e.length;o>t;t++)if(!e[t].dataset.active){e[t].dataset.active="1";var r=e[t].id;if(console.log(r,hasIAPace),r&&hasIAPace){var a=IB.iapace.loadInitialEval(r);a?(console.log(a),handleInteraction(e[t],a,e[t].dataset,!0)):(console.log("No initial data"),FunctionAttemptExec(initApi,5,1e3,e[t]))}}};alias.bind=bind,alias.unbind=function(){console.error("Not implemented")},bind()}();