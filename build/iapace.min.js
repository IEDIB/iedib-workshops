window.IB = window.IB || {}; window.IB.sd = window.IB.sd || {}; window.IAPace=window.IAPace||{},function(e){var t=4,n=function(e){for(var t={},n=e.substring(1).split("&"),i=0;i<n.length;i++){var r=n[i].split("=");r[0]&&(t[r[0]]=r[1]||!0)}return t},i=function(e,t){this._changeHandlers={},this.coursename=e,this.defaultLevel=4>=t?t:4,this._tree={},this.load()};i.prototype={load:function(){var e=localStorage.getItem("iapace");try{this._tree=JSON.parse(e)}catch(t){console.error(t)}var n=!1;this._tree||(this._tree={},n=!0),this._tree[this.coursename]||(this._tree[this.coursename]={dl:this.defaultLevel,ch:{},ia:{}},n=!0),n&&this.save()},save:function(){this._tree&&localStorage.setItem("iapace",JSON.stringify(this._tree))},drop:function(e){var t=null,n=null;(this._changeHandlers[e]||this._changeHandlers["*"])&&(t=this.inference(e));for(var i=Object.keys(this._tree[this.coursename].ch),r=0,s=i.length;s>r;r++)i[r].startsWith(e)&&delete this._tree[this.coursename].ch[i[r]];(this._changeHandlers[e]||this._changeHandlers["*"])&&(n=this.inference(e)),null!=t&&null!=n&&t!=n&&this._triggerChangeEvt(e,t,n)},find:function(e){return this._tree[this.coursename].ch[e]},create:function(e){var t=e.split("."),n=t[0];this.find(n)||(this._tree[this.coursename].ch[n]={n:0,s:0,s2:0,h:[]});for(var i=1,r=t.length;r>i;i++)n=n+"."+t[i],this.find(n)||(this._tree[this.coursename].ch[n]={n:0,s:0,s2:0,h:[]});return this._tree[this.coursename].ch[e]},saveInitialEval:function(e,t){this._tree[this.coursename].ia[e]=t,this.save()},loadInitialEval:function(e){return this._tree[this.coursename].ia[e]},findCreate:function(e){var t=this.find(e);return t||(t=this.create(e)),t},addScore:function(e,n){var i=null,r=null;(this._changeHandlers[e]||this._changeHandlers["*"])&&(i=this.inference(e));var s=this.findCreate(e);for(s.n+=1,s.s+=n,s.s2+=n*n,s.h.push(n);s.h.length>t;)s.h.shift();(this._changeHandlers[e]||this._changeHandlers["*"])&&(r=this.inference(e)),null!=i&&null!=r&&i!=r&&this._triggerChangeEvt(e,i,r)},level:function(e){var n=this.findCreate(e),i=n.n;if(i>0){var r=n.s/(1*i),s=Math.sqrt(Math.abs(n.s2/i-r*r));if(0==r)return 1;var a=s/r;if(n.h.length>=t){for(var h=0,c=0,l=n.h.length,o=0;l>o;o++){var u=n.h[o];h+=u,c+=u*u}if(h/=1*l,c=Math.sqrt(c/(1*l)-h*h),h>0&&(cv2=c/h,cv2<.75)){var f=.1*r+.9*h;r=f>r?f:r}}var d=Math.round(.4*r);return d>1&&a>.75&&(d-=1),d>0?d:1}return n.dl},inference:function(e){var t=this.find(e),n=e.split("."),i=n.slice(0,n.length-1).join(".");if(t){var r=this.level(e);return r?r:i?this.inference(i):this._tree[this.coursename].dl}return i?this.inference(i):this._tree[this.coursename].dl},toString:function(){return JSON.stringify(this._tree,null,2)},addChangeListener:function(e,t){var n=this._changeHandlers[e];n||(n=[],this._changeHandlers[e]=n),n.push(t)},_triggerChangeEvt:function(e,t,n){if(this._changeHandlers[e])for(var i=this._changeHandlers[e],r=0,s=i.length;s>r;r++)i[r](e,t,n);if(this._changeHandlers["*"])for(var i=this._changeHandlers["*"],r=0,s=i.length;s>r;r++)i[r](e,t,n)}},e.load=function(e,t){return new i(e,t)},window.IB=window.IB||{};var r,s="",a=document.querySelector(".homelink > a");if(a){courseName=a.innerText;var h="?"+(a.href.split("?")[1]||"");r=n(h).id}s=s||r||"tal_alg",window.IB.iapace=new i(s,2)}(window.IAPace);